<div class="body">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">


    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#tab_informacoes" data-toggle="tab">INFORMAÇÕES</a></li>
      <li role="presentation"><a href="#tab_vencimentos" data-toggle="tab">VENCIMENTOS E VALORES</a></li>
    </ul>

    <div class="tab-content">

       <!-- Tab INFORMAÇÕES -->
      <div role="tabpanel" class="tab-pane active" id="tab_informacoes">

            <div class="col-sm-6">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.descricao.label}}</label>{% if form.descricao.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.descricao.errors %}<label class="error">{% for error in form.descricao.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.descricao}}
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.status.label}}</label>{% if form.status.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.status.errors %}<label class="error">{% for error in form.status.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.status}}
                  <input type="hidden" id="id_status" name="status" value="{{form.status.initial}}" />
                </div>
              </div>
            </div>



            {% if form.fornecedor %}
            <div class="col-sm-6">
              <div class="form-group">
                <label>{{form.fornecedor.label}}</label>{% if form.fornecedor.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                {% if form.fornecedor.errors %}<label class="error">{% for error in form.fornecedor.errors %}{{error}}{% endfor %}</label>{% endif %}
                <div class="input-group" style="margin-bottom: 0px;">
                  <div class="form-line">
                    {{form.fornecedor}}
                  </div>
                  <a class="input-group-addon newwindow" style="color: green;" title="Adicionar fornecedor" href="{% url 'cadastro:addfornecedorview' %}"><i class="material-icons add-new-icon" title="Adicionar fornecedor">&#xE147;</i></a>
                </div>
              </div>
            </div>
            {% else %}
            <div class="col-sm-6">
              <div class="form-group">
                <label>{{form.cliente.label}}</label>{% if form.cliente.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                {% if form.cliente.errors %}<label class="error">{% for error in form.cliente.errors %}{{error}}{% endfor %}</label>{% endif %}
                <div class="input-group" style="margin-bottom: 0px;">
                  <div class="form-line">
                    {{form.cliente}}
                  </div>
                  <a class="input-group-addon newwindow" style="color: green;" title="Adicionar cliente" href="{% url 'cadastro:addclienteview' %}"><i class="material-icons add-new-icon" title="Adicionar cliente">&#xE147;</i></a>
                </div>
              </div>
            </div>
            {% endif %}

            <div class="col-sm-6">
              <div class="form-group">
                <label>{{form.grupo_plano.label}}</label>{% if form.grupo_plano.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                {% if form.grupo_plano.errors %}<label class="error">{% for error in form.grupo_plano.errors %}{{error}}{% endfor %}</label>{% endif %}
                <div class="input-group" style="margin-bottom: 0px;">
                  <div class="form-line">
                    {{form.grupo_plano}}
                  </div>
                  <a class="input-group-addon newwindow" style="color: green;" title="Adicionar classificação de saída" href="{% url 'financeiro:addgrupoview' %}"><i class="material-icons add-new-icon" title="Adicionar classificação de entrada/saída">&#xE147;</i></a>
                </div>
              </div>
            </div>



            <div class="col-sm-6">
              <div class="form-group">
                <label>{{form.centro_custo.label}}</label>{% if form.centro_custo.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                {% if form.centro_custo.errors %}<label class="error">{% for error in form.centro_custo.errors %}{{error}}{% endfor %}</label>{% endif %}
                <div class="input-group" style="margin-bottom: 0px;">
                  <div class="form-line">
                    {{form.centro_custo}}
                  </div>
                  <a class="input-group-addon popup" style="color: green;" title="Adicionar centro de custo" href="{% url 'financeiro:addcentrocustoview' %}"><i class="material-icons add-new-icon" title="Adicionar centro de custo">&#xE147;</i></a>
                </div>
              </div>
            </div>

          <div class="col-sm-6">
              <div class="form-group">
                <label>{{form.classificacao_dre.label}}</label>{% if form.classificacao_dre.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                {% if form.classificacao_dre.errors %}<label class="error">{% for error in form.classificacao_dre.errors %}{{error}}{% endfor %}</label>{% endif %}
                <div class="input-group" style="margin-bottom: 0px;">
                  <div class="form-line">
                    {{form.classificacao_dre}}
                  </div>
                </div>
              </div>
            </div>

             <div class="col-sm-6">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.conta_corrente.label}}</label>{% if form.conta_corrente.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.conta_corrente.errors %}<label class="error">{% for error in form.conta_corrente.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.conta_corrente}}
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="form-group">
					<label>{{form.depreciacao_bem.label}}</label></label>{% if form.depreciacao_bem.form.depreciacao_bem.required %}<strong style="color:red;"> *</strong>{% endif %}
					{% if form.depreciacao_bem.errors %}<label class="error">{% for error in form.depreciacao_bem.errors %}{{error}}{% endfor %}</label>{% endif %}
					<div class="input-group">
						<div class="form-line">
			      			{{form.depreciacao_bem}}
			      		</div>
		      		</div>
		      	</div>
            </div>

            <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.depreciacao_anos.label}}</label>{% if form.depreciacao_anos.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.depreciacao_anos.errors %}<label class="error">{% for error in form.depreciacao_anos.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.depreciacao_anos}}
                </div>
              </div>
            </div>


            <div class="col-sm-3">
                <div class="form-group">
                    <label>Taxa de Depreciação (por ano)</label>
                    <span id="depreciacao_porcentagem" style="display:block;font-size: x-large;padding-left: 10px;color: #ff4254;">0%</span>
                </div>
            </div>

             <div class="col-sm-3">
                        <div class="form-group">
                          <div class="form-line">
                            <label>{{form.arquivo.label}}</label>{% if form.arquivo.field.required %}<strong style="color:red;"> *</strong>{% endif %}{% if object.arquivo %}<i class="material-icons" style="font-size: 18px;margin-left: 10px;color: green;" title="Existe um arquivo armazenado.">&#xE876;</i>{% else %}<i class="material-icons" style="font-size: 18px;margin-left: 10px;color: red;" title="Nenhum arquivo armazenado.">&#xE14C;</i>{% endif %}
                            {% if form.arquivo.errors %}<label class="error">{% for error in form.arquivo.errors %}{{error}}{% endfor %}</label>{% endif %}
                            {{form.arquivo}}
                          </div>
                        </div>
              </div>

                {% if object.arquivo %}

                <div class="col-sm-3">
                        <div class="form-group">
                          <div class="form-line">
                            <a class="btn btn-default" style="margin-top: 30px" href="/{{ object.arquivo.url }}">Download do arquivo </a>
                        </div>
                  </div>
                </div>

                {% endif %}


             <div class="col-sm-6">
              <div class="form-group">
                <div class="form-line">
                  {{form.movimentar_caixa}}
                  <label for="id_movimentar_caixa" style="font-weight: bold;" title="Selecionar para debitar/creditar no fluxo de caixa.">{{form.movimentar_caixa.label}}</label>
                </div>
              </div>
            </div>

      </div>

      <div role="tabpanel" class="tab-pane" id="tab_vencimentos">

        <div class="col-sm-4">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.data_emissao.label}}</label>{% if form.data_emissao.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.data_emissao.errors %}<label class="error">{% for error in form.data_emissao.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.data_emissao}}
                </div>
              </div>
        </div>

         {% if form.status.initial == '0' %}
            <div class="col-sm-4">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.data_pagamento.label}}</label>{% if form.data_pagamento.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.data_pagamento.errors %}<label class="error">{% for error in form.data_pagamento.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.data_pagamento}}
                </div>
              </div>
            </div>
         {% endif %}


         <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.valor_total.label}}</label>{% if form.valor_total.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.valor_total.errors %}<label class="error">{% for error in form.valor_total.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.valor_total}}
                </div>
              </div>
          </div>

        <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.juros.label}}</label>{% if form.juros.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.juros.errors %}<label class="error">{% for error in form.juros.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.juros}}
                </div>
              </div>
         </div>


         <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.abatimento.label}}</label>{% if form.abatimento.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.abatimento.errors %}<label class="error">{% for error in form.abatimento.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.abatimento}}
                </div>
              </div>
          </div>

            <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.valor_liquido.label}}</label>{% if form.valor_liquido.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.valor_liquido.errors %}<label class="error">{% for error in form.valor_liquido.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.valor_liquido}}
                </div>
              </div>
            </div>

          <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.recorrencia.label}}</label>{% if form.recorrencia.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.recorrencia.errors %}<label class="error">{% for error in form.recorrencia.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.recorrencia}}
                </div>
              </div>
            </div>

          <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.tipo_recorrencia.label}}</label>{% if form.tipo_recorrencia.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.tipo_recorrencia.errors %}<label class="error">{% for error in form.tipo_recorrencia.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.tipo_recorrencia}}
                </div>
              </div>
            </div>

          <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.primeiro_vencimento.label}}</label>{% if form.primeiro_vencimento.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.primeiro_vencimento.errors %}<label class="error">{% for error in form.primeiro_vencimento.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.primeiro_vencimento}}
                </div>
              </div>
            </div>

          <div class="col-sm-3">
              <div class="form-group">
                <div class="form-line">
                  <label>{{form.quantidade_parcelas.label}}</label>{% if form.quantidade_parcelas.field.required %}<strong style="color:red;"> *</strong>{% endif %}
                  {% if form.quantidade_parcelas.errors %}<label class="error">{% for error in form.quantidade_parcelas.errors %}{{error}}{% endfor %}</label>{% endif %}
                  {{form.quantidade_parcelas}}
                </div>
              </div>
            </div>

          <div class="col-sm-3">
              <a id="calcular-parcelas" class="btn btn-primary" style="margin-top: 25px;">Calcular parcelas</a>
          </div>




        <div class="formset-tr-field">

          <table class="table table-responsive table-bordered table-striped form-table {{table_class}}">


            <thead>
              <tr>

                <th>Parcela</th>
                <th>Vencimento</th>
                <th>Valor</th>

              </tr>
            </thead>

            <tbody id="aqui">


            </tbody>

          </table>

        </div>

      </div>

  </div>

</div>

  <button class="btn btn-success foot-btn" type="submit"><i class="material-icons">&#xE148;</i><span> SALVAR</span></button>

</div>


{% block js %}

<script>

    $(function () {

        calcula_depreciacao();
        calculaParcelas();

        function calcula_depreciacao() {
            var anos = $("#id_depreciacao_anos").val();

            var depreciacao_porcentagem = '0';

            if (anos != '') {
                depreciacao_porcentagem = (100 / anos).toFixed(2);
            }

            $("#depreciacao_porcentagem").text(depreciacao_porcentagem + '%');
        }

        $('#id_depreciacao_bem').click(function () {
            var valor = $('#id_depreciacao_bem').val();
            // alert(valor);

            if (valor == 8 || valor == 6 || valor == 10 || valor == 7 || valor == 1) {
                $("#id_depreciacao_anos").val(10);
            } else if (valor == 11 || valor == 3 || valor == 4 || valor == 2 || valor == 9) {
                $("#id_depreciacao_anos").val(5);
            } else if (valor == 12) {
                $("#id_depreciacao_anos").val(2.5);
            } else if (valor == 5) {
                $("#id_depreciacao_anos").val(25);
            } else {
                $("#id_depreciacao_anos").val('');
            }

            calcula_depreciacao();

        });

        $('#id_depreciacao_anos').change(function () {
            calcula_depreciacao();
        })

    });

    $('#calcular-parcelas').click(function () {
        calculaParcelas();
    });

    function calculaParcelas() {
        $(document).ready(function () {

            vencimento = $("#id_primeiro_vencimento").val();

            function stringToDate(dateString) {
                var dateParts = dateString.split("/");

                return new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]);
            }

            dateObject = stringToDate(vencimento);

            function formattedDate(d = new Date) {
                return [d.getDate(), d.getMonth() + 1, d.getFullYear()]
                    .map(n => n < 10 ? `0${n}` : `${n}`).join('/');
            }

            vencimento_string = formattedDate(dateObject);


            // vencimento_string = vencimento_data.toDateString('dd/mm/yyyy');
            numero_parcelas = $("#id_quantidade_parcelas").val();
            valor_liquido = parseFloat($("#id_valor_liquido").val().replace(',', '.'));
            valor_parcelado = parseFloat(valor_liquido / numero_parcelas).toFixed(2);
            resto = (valor_liquido - (valor_parcelado * numero_parcelas)).toFixed(2);
            ultima_parcela = (parseFloat(resto) + parseFloat(valor_parcelado)).toFixed(2);
            recorrencia = parseInt($("#id_recorrencia").val());
            tipo_recorrencia = $("#id_tipo_recorrencia").val();


            $('#aqui tr').remove();



            vencimento = stringToDate(vencimento);


            for (i = 1; i <= numero_parcelas; i++) {

                vencimento_str = formattedDate(vencimento);

                if (i == numero_parcelas) {
                    $('#aqui').append(
                        '<tr>' +
                        '<td>' + i + '</td>' +
                        '<td>' + vencimento_str + '</td>' +
                         '<td>' + ultima_parcela + '</td>' +
                        '</tr>'
                    );
                } else {
                    $('#aqui').append(
                        '<tr>' +
                        '<td>' + i + '</td>' +
                        '<td>' + vencimento_str + '</td>' +
                        '<td>'  + valor_parcelado + '</td>' +
                        '</tr>'
                    );
                }

                if (tipo_recorrencia == 1) {
                    vencimento.setDate(vencimento.getDate() + recorrencia);
                } else if (tipo_recorrencia == 2) {
                    vencimento.setMonth(vencimento.getMonth() + recorrencia);
                } else {
                    vencimento.setFullYear(vencimento.getFullYear() + recorrencia);
                }

            }


        });
    }


</script>

{% endblock %}